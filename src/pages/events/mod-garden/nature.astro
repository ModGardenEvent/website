---
import Layout from "../../../layouts/Layout.astro";
import { Image } from "astro:assets";
import ProjectCard from "../../../components/ProjectCard.astro";

import natureLogo from "../../../icons/events/nature/logo-full.png";
import type { Project } from "../../../ts/ModGardenAPI";
import { getEventProjects } from "../../../ts/ModGardenAPI";
import { formatTime, isoTime } from "../../../ts/TimeHelper";
import { getModrinthProject, type Mod } from "../../../ts/ModrinthHelper";

type ProjectAndMod = {
    project: Project;
    mod: Mod;
}

async function getProjects() : Promise<ProjectAndMod[]> {
  const unsortedProjects = await getEventProjects("mod-garden-nature");
  const projects = new Array<ProjectAndMod>(unsortedProjects.length);
  for (let i = 0; i < unsortedProjects.length; ++i) {
    const project = unsortedProjects[i];
    const mod = await getModrinthProject(project.modrinth_id);
    projects[i] = { project: project, mod: mod } as ProjectAndMod;
  }
  projects.sort((a, b) => a.mod.title.localeCompare(b.mod.title))
  return projects;
}

const projects: ProjectAndMod[] = await getProjects();

const planningStart = "2025-05-18T00:00:00Z";
const planningEnd = "2025-05-25T00:00:00Z";
const developmentStart = "2025-05-25T00:00:00Z";
const tweakStart = "2025-08-22T00:00:00Z";
const buildStart = "2025-09-05T00:00:00Z";
const buildEnd = "2025-10-01T00:00:00Z";
const showcaseStart = "2025-10-03T00:00:00Z";
const showcaseEnd = "2025-10-10T00:00:00Z";
---

<Layout title="Mod Garden: Nature" favicon="/images/icon/nature.png" image="/images/icon/nature.png" color="#68ae26">
  <div class="mt-4 mb-4 flex flex-col items-center justify-center space-y-4">
    <div class="flex flex-col lg:flex-row lg:space-x-4 w-4/5">
      <div class="lg:basis-2/3 rounded-lg bg-white p-6 text-black shadow-md dark:bg-zinc-800 dark:text-white items-center justify-center text-center">
        <h1 class="mb-4 border-0 border-b-4 border-leaf-200 text-xl font-bold text-black dark:text-white">
          Mod Garden Presents:
        </h1>
        <div class="space-y-4 lg:mx-10">
          <Image src={natureLogo} alt="Mod Garden: Nature" class="mx-auto" />
          <p>
            Welcome to The Yuukaflower Forest National Park - Where <b>Nature</b> Awaits
          </p>
          <p>
            <i>The Yuukaflower Forest National Park is a new and upcoming national park. Built to preserve nature within
            its purest form.</i>
          </p>
          <p>
            <i>Visit within the day, where it will be quite serene and comfortable. Or wait until the night when the
            garden will awaken; where the unknown natures of this world could await you.</i>
          </p>
          <p>
            <i>At Yuukaflower, we also offer a place to stay inside the nature of the park within our cabins, or you may
            go out and seek the sights to behold.</i>
          </p>
          <p>
            Although the real question is what nature will there be to preserve? That's where you come in! The
            ecosystem of Yuukaflower Forest is yours to create and shape!
          </p>
          <p>
            As modders, you will be developing mods for Fabric on 1.21.5 that fit the theme of Nature. Come get a taste of an early variation of the upcoming Minecraft rendering changes.
          </p>
          <h1 class="mb-4 border-0 border-b-4 border-leaf-200 text-xl font-bold text-black dark:text-white ">
            Features
          </h1>
          <div class="px-12 text-left">
            <li>Take a look at mods created by modders across a two month timespan, made to fit the theme of Nature.</li>
            <li>Explore a cozy map featuring the new Pale Garden biome, a large flowery area, and stay the night within the cabins.</li>
          </div>
          <h1 class="mb-4 border-0 border-b-4 border-leaf-200 text-xl font-bold text-black dark:text-white ">
            Event Information
          </h1>
          <div class="overflow-x-auto">
            <table class="table-auto">
              <tr>
                <th class="px-6 py-3 border border-gray-200 bg-gray-50 dark:bg-zinc-700 text-left text-xs leading-4 font-medium uppercase tracking-wider">
                  Platform
                </th>
                <td class="w-full px-4 py-4 whitespace-normal border border-gray-200 bg-gray-50 dark:bg-zinc-700">
                  <span class="text-sm font-medium">Fabric 1.21.5</span>
                </td>
              </tr>
              <tr>
                <th class="px-6 py-3 border border-gray-200 bg-gray-50 dark:bg-zinc-700 text-left text-xs leading-4 font-medium uppercase tracking-wider">
                  Themes
                </th>
                <td class="w-full px-4 py-4 whitespace-normal border border-gray-200 bg-gray-50 dark:bg-zinc-700">
                  <span class="text-sm font-medium">Nature, Ecosystems, Habitats; Flora, Fauna and anything in between</span>
                </td>
              </tr>
              <tr>
                <th class="px-6 py-3 border border-gray-200 text-left text-xs leading-4 font-medium uppercase tracking-wider">
                  Showcase World
                </th>
                <td class="w-full px-4 py-4 whitespace-normal border border-gray-200">
                  <span class="text-sm font-medium">National Park (Random Seed)</span>
                </td>
              </tr>
              <tr>
                <th class="px-6 py-3 border border-gray-200 bg-gray-50 dark:bg-zinc-700 text-left text-xs leading-4 font-medium uppercase tracking-wider">
                  Size
                </th>
                <td class="w-full px-4 py-4 whitespace-normal border border-gray-200 bg-gray-50 dark:bg-zinc-700">
                  <span class="text-sm font-medium">512&times;512 Blocks</span>
                </td>
              </tr>
              <tr>
                <th class="px-6 py-3 border border-gray-200 text-left text-xs leading-4 font-medium uppercase tracking-wider">
                  Districts (Excluding Spawn)
                </th>
                <td class="w-full px-6 py-4 whitespace-normal border border-gray-200">
                  <span class="text-sm font-medium">3 (Flowery, Pale Garden and Cabins)</span>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div class="lg:basis-1/3 rounded-lg bg-white p-6 text-black shadow-md dark:bg-zinc-800 dark:text-white">
        <h1 class="mb-4 border-0 border-b-4 border-leaf-200 text-xl font-bold text-black dark:text-white">
          Timeline
        </h1>
        <div class="mx-auto items-center justify-center space-y-4 text-center">
          <ol class="relative border-s border-leaf-600 dark:border-leaf-200">
            <li class="mb-[19.5%] ms-4">
              <div class="absolute w-3 h-3 bg-pine-500 rounded-full mt-1.5 -start-1.5 dark:bg-pine-700"></div>
              <time datetime={isoTime(planningStart)} data-start-time={planningStart} class="mb-1 text-sm font-normal leading-none italic">{formatTime(planningStart)} - {formatTime(planningEnd)}</time>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Planning Stage</h3>
              <p class="text-base font-normal">
                Here you can sign up, and start planning your project. This is the time to start forming teams, planning ideas and general brainstorming.
              </p>
            </li>
            <li class="mb-[19.5%] ms-4">
              <div class="absolute w-3 h-3 bg-pine-500 rounded-full mt-1.5 -start-1.5 dark:bg-pine-700"></div>
              <time datetime={isoTime(developmentStart)} data-start-time={developmentStart} class="mb-1 text-sm font-normal leading-none italic">{formatTime(developmentStart)} - {formatTime(tweakStart)}</time>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Development Stage</h3>
              <p class="text-base font-normal">
                This is when you start working on your project(s). You should be submitted to Modrinth at the end of this stage.
              </p>
            </li>
            <li class="mb-[19.5%] ms-4">
              <div class="absolute w-3 h-3 bg-pine-500 rounded-full mt-1.5 -start-1.5 dark:bg-pine-700"></div>
              <time datetime={isoTime(tweakStart)} data-start-time={tweakStart} class="mb-1 text-sm font-normal leading-none italic">{formatTime(tweakStart)} - {formatTime(buildStart)}</time>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Tweak Stage</h3>
              <p class="text-base font-normal">
                This period is all about fixing bugs, and integrating with other mods to have cross compatibility. Extensions will last until the end of the first week of this phase.
              </p>
            </li>
            <li class="mb-[19.5%] ms-4">
              <div class="absolute w-3 h-3 bg-pine-500 rounded-full mt-1.5 -start-1.5 dark:bg-pine-700"></div>
              <time datetime={isoTime(buildStart)} data-start-time={buildStart} class="mb-1 text-sm font-normal leading-none italic">{formatTime(buildStart)} - {formatTime(buildEnd)}</time>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Building Stage</h3>
              <p class="text-base font-normal">
                This stage is optional, but if you want to build a booth for your project, this is the time to do it.
              </p>
            </li>
            <li class="ms-4">
              <div class="absolute w-3 h-3 bg-pine-500 rounded-full mt-1.5 -start-1.5 dark:bg-pine-700"></div>
              <time datetime={isoTime(showcaseStart)} data-start-time={showcaseStart} class="mb-1 text-sm font-normal leading-none italic">{formatTime(showcaseStart)} - {formatTime(showcaseEnd)}</time>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Showcase Stage</h3>
              <p class="text-base font-normal">
                This is when the event server is up and running, where you and players can visit booths for all the projects. Players may vote for mods and awards are given in this stage. The server will still be up for some time after this phase ends.
              </p>
            </li>
          </ol>
        </div>
      </div>
    </div>
    <div
      class="mx-auto mt-4 min-h-24 w-4/5 rounded-lg bg-white p-6 text-black shadow-md dark:bg-zinc-800 dark:text-white">
      <h1 class="mb-4 border-0 border-b-4 border-leaf-200 text-xl font-bold text-black dark:text-white">
        Submitted Projects
      </h1>
      <div class="grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-3">
        {projects.map((project) => (
          <ProjectCard
            submission={project.project}
            mod={project.mod}
            showUserInfo={true}
          />
        ))}
        {projects.length === 0 && (
          <div class="col-span-full text-center">
            No projects submitted yet, you could be the first!
          </div>
        )
        }
      </div>
    </div>
    <br>
  </div>
</Layout>
<style>
  @reference "../../../styles/global.css";
  .current-timeline-entry {
      @apply bg-leaf-200/10 border-l-4 border-leaf-300 py-3
  }
</style>
<script>
  import Moment from "moment";
  function highlightCurrentTimelineEntry() {
    let timelineEntries = Array.from(document.querySelectorAll("[data-start-time]")).reverse();
    let currentTime = Moment();
    for (let entry of timelineEntries) {
      if (!entry.parentElement)
        return;
      const startTime = Moment(entry.getAttribute("data-start-time"));
      if (currentTime.isAfter(startTime)) {
        entry.parentElement.classList.add("current-timeline-entry");
        return;
      } else {
        entry.parentElement.classList.remove("current-timeline-entry");
      }
    }
  }
  highlightCurrentTimelineEntry();
  setInterval(highlightCurrentTimelineEntry, 1000 * 60);
</script>